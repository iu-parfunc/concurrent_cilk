[?1049h[?1h=[1;55r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[54;1H"scheduler.c" 3185L, 109974C"../../../concurrent_cilk/libcilkrts/runtime/scheduler.c" 2531L, 77620C[1;1H[34m[47m  [m[91m#include [m[36m<stdio.h>[m  [93m// sprintf[m[58C[7m|[m
[34m[47m  [m[91m#include [m[36m<stdlib.h>[m [93m// malloc, free, abort[m[46C[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[91m#ifdef _WIN32[m[75C[7m|[m
[34m[47m  [m[91m#   pragma warning(disable:[m[38;5;130m1786[m[91m)   [m[93m// disable warning: sprintf is deprecated[m[12C[7m|[m
[34m[47m  [m[91m#   include [m[36m"sysdep-win.h"[m[62C[7m|[m
[34m[47m  [m[91m#endif[m  [93m// _WIN32[m[71C[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[93m// ICL: Don't complain about conversion from pointer to same-sized integral[m[13C[7m|[m
[34m[47m  [m[93m// type in __cilkrts_put_stack.  That's why we're using ptrdiff_t[m[23C[7m|[m
[34m[47m  [m[91m#ifdef _WIN32[m[75C[7m|[m
[34m[47m  [m[91m#   pragma warning(disable: [m[38;5;130m1684[m[91m)[m[55C[7m|[m
[34m[47m  [m[91m#endif[m[82C[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m+ [m[38;5;248m[48;5;242m+-- 12 lines: #include "cilk/cilk_api.h"------------------------------------------------[m[7m|[m
[34m[47m  [m[91m#endif[m[82C[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[91m#ifndef _WIN32[m[74C[7m|[m
[34m[47m  [m[91m#   include [m[36m<unistd.h>[m[66C[7m|[m
[34m[47m  [m[91m#endif[m[82C[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[93m[45m//[m[1m[93m[41m#define DEBUG_LOCKS 1[m[45m                                                                 [m[7m|[m
[34m[47m  [m[1m[91m[41m#ifdef DEBUG_LOCKS[m[45m                                                                      [m[7m|[m
[34m[47m  [m[93m[45m//[m[1m[93m[41m The currently executing worker must own this worker's lock[m[45m                           [m[7m|[m
[34m[47m  [m[91m[45m#[m[1m[91m[41m   define ASSERT_WORKER_LOCK_OWNED(w) \[m[45m                                                [m[7m|[m
[34m[47m  [m[1m[91m[41m        { \[m[45m                                                                             [m[7m|[m
[34m[47m  [m[1m[91m[41m            __cilkrts_worker *tls_worker = __cilkrts_get_tls_worker(); \[m[45m                [m[7m|[m
[34m[47m  [m[1m[91m[41m            [m[38;5;248m[104mCILK[m[1m[91m[41m_ASSERT((w)->l->lock.owner == tls_worker); \[m[45m                            [m[7m|[m
[34m[47m  [m[1m[91m[41m        }[m[45m                                                                               [m[7m|[m
[34m[47m  [m[1m[91m[41m#else[m[45m                                                                                   [m[7m|[m
[34m[47m  [m[1m[91m[41m#   define ASSERT_WORKER_LOCK_OWNED(w)[m[45m                                                  [m[7m|[m
[34m[47m  [m[1m[91m[41m#endif[m[1m[41m [m[1m[93m[41m// DEBUG_LOCKS[m[45m                                                                   [m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                           [m[7m|[m
[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                         [m[7m|[m
[34m[47m  [m[44m                  SCHEDULE_WAIT,                                                        [m[7m|[m
[34m[47m  [m[44m                  SCHEDULE_EXIT };                                                      [m[7m|[m
[34m[47m  [m[88C[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[7m|[m
[1m[7mscheduler.c                                                             91,0-1          1% [m[1;92H[34m[47m  [m[91m#include [m[36m<stdio.h>[m  [93m// sprintf[m[2;92H[34m[47m  [m[91m#include [m[36m<stdlib.h>[m [93m// malloc, free, abort[m[3;92H[34m[47m  [4;92H  [m[91m#ifdef _WIN32[m[5;92H[34m[47m  [m[91m#   pragma warning(disable:[m[38;5;130m1786[m[91m)   [m[93m// disable warning: sprintf is deprecated[m[6;92H[34m[47m  [m[91m#   include [m[36m"sysdep-win.h"[m[7;92H[34m[47m  [m[91m#endif[m  [93m// _WIN32[m[8;92H[34m[47m  [9;92H  [m[44m                                                                                       [m[10;92H[34m[47m  [m[93m// ICL: Don't complain about conversion from pointer to same-sized integral[m[11;92H[34m[47m  [m[93m// type in __cilkrts_put_stack.  That's why we're using ptrdiff_t[m[12;92H[34m[47m  [m[91m#ifdef _WIN32[m[13;92H[34m[47m  [m[91m#   pragma warning(disable: [m[38;5;130m1684[m[91m)[m[14;92H[34m[47m  [m[91m#endif[m[15;92H[34m[47m  [16;92H+ [m[38;5;248m[48;5;242m+-- 12 lines: #include "cilk/cilk_api.h"-----------------------------------------------[m[17;92H[34m[47m  [m[91m#endif[m[18;92H[34m[47m  [19;92H  [m[91m#ifndef _WIN32[m[20;92H[34m[47m  [m[91m#   include [m[36m<unistd.h>[m[21;92H[34m[47m  [m[91m#endif[m[22;92H[34m[47m  [23;92H  [m[93m[45m//[m[1m[93m[41mcsz:[m[45m                                                                                 [m[24;92H[34m[47m  [m[1m[93m[41m//respect the choice to keep this function private from global_state.h [m[45m                [m[25;92H[34m[47m  [m[93m[45m//[m[1m[93m[41mand only include it when we need it[m[45m                                                  [m[26;92H[34m[47m  [m[91m[45m#[m[1m[91m[41mifdef [m[38;5;248m[104mCILK[m[1m[91m[41m_IVARS_PTHREAD_VARIANT[m[45m                                                      [m[27;92H[34m[47m  [m[1m[32m[41mextern[m[1m[41m global_state_t *cilkg_get_user_settable_values([m[1m[32m[41mvoid[m[1m[41m);[m[45m                           [m[28;92H[34m[47m  [m[1m[91m[41m#endif[m[45m                                                                                 [m[29;92H[34m[47m  [m[45m                                                                                       [m[30;92H[34m[47m  [m[1m[93m[41m/*[m[45m                                                                                     [m[31;92H[34m[47m  [m[1m[93m[41m * Make a worker into a system worker.[m[45m                                                 [m[32;92H[34m[47m  [m[1m[93m[41m */[m[45m                                                                                    [m[33;92H[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[1m[32m[41mvoid[m[1m[41m make_worker_system(__cilkrts_worker *w) {[m[45m                                  [m[34;92H[34m[47m  [m[44m  [m[38;5;248m[104mCILK[m[44m_ASSERT(WORKER_FREE == w->l->type);                                              [m[35;92H[34m[47m  [m[44m  w->l->type = WORKER_SYSTEM;                                                          [m[36;92H[34m[47m  [m[44m  w->l->signal_node = signal_node_create();                                            [m[37;92H[34m[47m  [m[44m                                                                                       [m[38;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[39;92H[34m[47m  [m[44m  [m[93m[44m// Only system workers have a ready queue:[m[44m                                           [m[40;92H[34m[47m  [m[44m  [m[93m[44m//[m[44m                                                                                   [m[41;92H[34m[47m  [m[44m  [m[93m[44m// NOTE: In an earlier design there was a ready_queue here, but it has (temporarily?)[m[42;92H[34m[47m  [m[44m  [m[93m[44m// promoted to be global.[m[44m                                                            [m[43;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[44;92H[34m[47m  [m[44m}                                                                                      [m[45;92H[34m[47m  [46;92H  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[47;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[48;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[49;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[50;92H[34m[47m  [51;92H  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[52;92H[34m[47m  [m[93m[44m//   Header includes, macros, and other bits that should be filed away properly once[m[44m   [m[53;92H[7m../../../concurrent_cilk/libcilkrts/runtime/scheduler.c                76,0-1          1%[45;3H[?12l[?25h[?25l[m[54;1HType  :quit<Enter>  to exit Vim[54;32H[K[53;163H[7m103,0-1[45;3H[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[m[1;1H[34m[47m  [m[1m[91m[41m        { \[m[45m                                                                             [m
[34m[47m  [m[1m[91m[41m            __cilkrts_worker *tls_worker = __cilkrts_get_tls_worker(); \[m[45m                [m
[34m[47m  [m[1m[91m[41m            [m[38;5;248m[104mCILK[m[1m[91m[41m_ASSERT((w)->l->lock.owner == tls_worker); \[m[45m                            [m
[34m[47m  [m[1m[91m[41m        }[m[45m                                                                               [m
[34m[47m  [m[1m[91m[41m#else[m[45m                                                                                   [m
[34m[47m  [m[1m[91m[41m#   define ASSERT_WORKER_LOCK_OWNED(w)[m[45m                                                  [m
[34m[47m  [m[1m[91m[41m#endif[m[1m[41m [m[1m[93m[41m// DEBUG_LOCKS[m[45m                                                                   [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                           [m
[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                         [m
[34m[47m  [m[44m                  SCHEDULE_WAIT,                                                        [m
[34m[47m  [m[44m                  SCHEDULE_EXIT };                                                      [m
[34m[47m  [m                                                                                        
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [27;1H[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  
  [m[93m[45m// [m[1m[93m[41mVerify that "w" is the worker we are currently executing on.[m[45m                         [m
[34m[47m  [m[1m[93m[41m// Because this check is expensive, this method is usually a no-op.[m[45m                     [m
[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[1m[32m[41minline[m[1m[41m [m[1m[32m[41mvoid[m[1m[41m verify_current_wkr(__cilkrts_worker *w)[m[45m                              [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m[1;92H[34m[47m  [m[1m[32m[41mextern[m[1m[41m global_state_t *cilkg_get_user_settable_values([m[1m[32m[41mvoid[m[1m[41m);[m[45m                           [m[2;92H[34m[47m  [m[1m[91m[41m#endif[m[45m                                                                                 [m[3;92H[34m[47m  [m[45m                                                                                       [m[4;92H[34m[47m  [m[1m[93m[41m/*[m[45m                                                                                     [m[5;92H[34m[47m  [m[1m[93m[41m * Make a worker into a system worker.[m[45m                                                 [m[6;92H[34m[47m  [m[1m[93m[41m */[m[45m                                                                                    [m[7;92H[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[1m[32m[41mvoid[m[1m[41m make_worker_system(__cilkrts_worker *w) {[m[45m                                  [m[8;92H[34m[47m  [m[44m  [m[38;5;248m[104mCILK[m[44m_ASSERT(WORKER_FREE == w->l->type);                                              [m[9;92H[34m[47m  [m[44m  w->l->type = WORKER_SYSTEM;                                                          [m[10;92H[34m[47m  [m[44m  w->l->signal_node = signal_node_create();                                            [m[11;92H[34m[47m  [m[44m                                                                                       [m[12;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[13;92H[34m[47m  [m[44m  [m[93m[44m// Only system workers have a ready queue:[m[44m                                           [m[14;92H[34m[47m  [m[44m  [m[93m[44m//[m[44m                                                                                   [m[15;92H[34m[47m  [m[44m  [m[93m[44m// NOTE: In an earlier design there was a ready_queue here, but it has (temporarily?)[m[16;92H[34m[47m  [m[44m  [m[93m[44m// promoted to be global.[m[44m                                                            [m[17;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[18;92H[34m[47m  [m[44m}                                                                                      [m[19;92H[34m[47m  [m                                                                                       [20;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[21;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[22;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[23;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[24;92H[34m[47m  [m                                                                                       [25;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[26;92H[34m[47m  [m[93m[44m//   Header includes, macros, and other bits that should be filed away properly once[m[44m   [m[27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m[93m[44m//   Concurrent Cilk is fully integrated with the build system.[m[44m                        [m[28;92H[34m[47m  [29;92H  [m[93m[45m// [m[1m[93m[41mHelper used for debugging:[m[45m                                                          [m[30;92H[34m[47m  [m[1m[32m[41mvoid[m[1m[41m __cilkrts_show_threadid() {[m[45m                                                       [m[31;92H[34m[47m  [m[1m[41m  pthread_t id = pthread_self();[m[45m                                                       [m[32;92H[34m[47m  [m[44m  fprintf([m[38;5;130m[44mstderr[m[44m, [m[36m[44m"TID [m[38;5;130m[44m%lu[m[36m[44m "[m[44m, ([m[32m[44munsigned[m[44m [m[32m[44mlong[m[44m)id);                                      [m[33;92H[34m[47m  [m[44m}                                                                                      [m[34;92H[34m[47m  [m[44m                                                                                       [m[35;92H[34m[47m  [m[91m[44m#define IVAR_DBG_PRINT_(lvl, ...) [m[38;5;81m[44mif[m[91m[44m(IVAR_DBG >= lvl) {    \[m[44m                           [m[36;92H[34m[47m  [m[91m[44m  pthread_t id = pthread_self(); [m[32m[44mchar[m[91m[44m buf[[m[38;5;130m[44m512[m[91m[44m];             \[m[44m                          [m[37;92H[34m[47m  [m[91m[44m  sprintf(buf, __VA_ARGS__);                                \[m[44m                          [m[38;92H[34m[47m  [m[91m[44m  [m[32m[44mvolatile[m[91m[44m [m[92m[44mstruct[m[91m[44m __cilkrts_worker* tw = __cilkrts_get_tls_worker(); \[m[44m                 [m[39;92H[34m[47m  [m[91m[44m  fprintf([m[38;5;130m[44mstderr[m[91m[44m, [m[36m[44m"[tid/W [m[38;5;130m[44m%3d[m[36m[44m [m[38;5;130m[44m%2d[m[36m[44m/[m[38;5;130m[44m%p[m[36m[44m] [m[38;5;130m[44m%s[m[36m[44m"[m[91m[44m, ([m[32m[44mint[m[91m[44m)((([m[32m[44mint[m[91m[44m)id)%[m[38;5;130m[44m1000[m[91m[44m), tw ? tw->self : -[m[38;5;130m[44m9999[m[40;92H[34m[47m  [m[44m                                                                                       [m[41;92H[34m[47m  [m[93m[44m// RRN: TEMP: Using a simple concurrent queue implementation.  It would be better to us[m[42;92H[34m[47m  [m[91m[44m#define QUEUE_ELEMTY [m[92m[44mstruct[m[91m[44m __cilkrts_paused_stack[m[44m                                     [m[43;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_queue.h"[m[44m                                                          [m[44;92H[34m[47m  [m[91m[44m#undef QUEUE_ELEMTY[m[44m                                                                    [m[45;92H[34m[47m  [m[44m                                                                                       [m[46;92H[34m[47m  [m[91m[44m#if [m[38;5;248m[104mCILK[m[91m[44m_IVARS == [m[38;5;248m[104mCILK[m[91m[44m_IVARS_PTHREAD_VARIANT[m[44m                                           [m[47;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk_pthread.c"[m[44m                                                   [m[48;92H[34m[47m  [m[91m[44m#else[m[44m                                                                                  [m[49;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk.c"[m[44m                                                           [m[50;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[51;92H[34m[47m  [m[93m[44m// This function is a `yield` for defining coroutines.  It stops the current computatio[m[52;92H[34m[47m  [m[93m[44m// to a ready queue to be awoken after other tasks are given a chance to run.[m[44m          [m[53;164H[7m11,1  [9C3[m[54;1H[K[53;73H[1m[7m100,1  [9C2%[31;3H[?12l[?25h[?25l[m[54;1HType  :quit<Enter>  to exit Vim[31;3H[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[1;1H[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                           [m
[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                         [m
[34m[47m  [m[44m                  SCHEDULE_WAIT,                                                        [m
[34m[47m  [m[44m                  SCHEDULE_EXIT };                                                      [m
[34m[47m  [m                                                                                        
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[93m[45m// [m[1m[93m[41mVerify that "w" is the worker we are currently executing on.[m[45m                         [m
[34m[47m  [m[1m[93m[41m// Because this check is expensive, this method is usually a no-op.[m[45m                     [m
[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[1m[32m[41minline[m[1m[41m [m[1m[32m[41mvoid[m[1m[41m verify_current_wkr(__cilkrts_worker *w)[m[45m                              [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [44;1H[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m{
[34m[47m  [m[1m[91m[41m#if REDPAR_DEBUG >= [m[1m[38;5;130m[41m3[m[45m                                                                   [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[93m[41m// Lookup the worker from TLS and compare to w. [m[45m                                    [m
[34m[47m  [m[45m  [m[1m[41m  __cilkrts_worker* tmp = __cilkrts_get_tls_worker();[m[45m                                 [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (w != tmp) {[m[45m                                                                     [m
[34m[47m  [m[45m  [m[1m[41m      fprintf([m[1m[38;5;130m[41mstderr[m[1m[41m, [m[1m[36m[41m"Error.  W=[m[1m[38;5;130m[41m%d[m[1m[36m[41m, actual worker =[m[1m[38;5;130m[41m%d[m[1m[36m[41m...[m[1m[38;5;130m[41m\n[m[1m[36m[41m"[m[1m[41m,[m[45m                         [m
[34m[47m  [m[45m  [m[1m[41m              w->self,[m[45m                                                                [m
[34m[47m  [m[45m    [m[1m[41m            tmp->self[m[45m);                                                             [m[1;92H[34m[47m  [m[44m  w->l->signal_node = signal_node_create();                                            [m[2;92H[34m[47m  [m[44m                                                                                       [m[3;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[4;92H[34m[47m  [m[44m  [m[93m[44m// Only system workers have a ready queue:[m[44m                                           [m[5;92H[34m[47m  [m[44m  [m[93m[44m//[m[44m                                                                                   [m[6;92H[34m[47m  [m[44m  [m[93m[44m// NOTE: In an earlier design there was a ready_queue here, but it has (temporarily?)[m[7;92H[34m[47m  [m[44m  [m[93m[44m// promoted to be global.[m[44m                                                            [m[8;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[9;92H[34m[47m  [m[44m}                                                                                      [m[10;92H[34m[47m  [m                                                                                       [11;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[12;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[13;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[14;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[15;92H[34m[47m  [m                                                                                       [16;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[17;92H[34m[47m  [m[93m[44m//   Header includes, macros, and other bits that should be filed away properly once[m[44m   [m[18;92H[34m[47m  [m[93m[44m//   Concurrent Cilk is fully integrated with the build system.[m[44m                        [m[19;92H[34m[47m  [m                                                                                       [20;92H[34m[47m  [m[93m[45m// [m[1m[93m[41mHelper used for debugging:[m[45m                                                          [m[21;92H[34m[47m  [m[1m[32m[41mvoid[m[1m[41m __cilkrts_show_threadid() {[m[45m                                                       [m[22;92H[34m[47m  [m[1m[41m  pthread_t id = pthread_self();[m[45m                                                       [m[23;92H[34m[47m  [m[44m  fprintf([m[38;5;130m[44mstderr[m[44m, [m[36m[44m"TID [m[38;5;130m[44m%lu[m[36m[44m "[m[44m, ([m[32m[44munsigned[m[44m [m[32m[44mlong[m[44m)id);                                      [m[24;92H[34m[47m  [m[44m}                                                                                      [m[25;92H[34m[47m  [m[44m                                                                                       [m[26;92H[34m[47m  [m[91m[44m#define IVAR_DBG_PRINT_(lvl, ...) [m[38;5;81m[44mif[m[91m[44m(IVAR_DBG >= lvl) {    \[m[44m                           [m[27;92H[34m[47m  [m[91m[44m  pthread_t id = pthread_self(); [m[32m[44mchar[m[91m[44m buf[[m[38;5;130m[44m512[m[91m[44m];             \[m[44m                          [m[28;92H[34m[47m  [m[91m[44m  sprintf(buf, __VA_ARGS__);                                \[m[44m                          [m[29;92H[34m[47m  [m[91m[44m  [m[32m[44mvolatile[m[91m[44m [m[92m[44mstruct[m[91m[44m __cilkrts_worker* tw = __cilkrts_get_tls_worker(); \[m[44m                 [m[30;92H[34m[47m  [m[91m[44m  fprintf([m[38;5;130m[44mstderr[m[91m[44m, [m[36m[44m"[tid/W [m[38;5;130m[44m%3d[m[36m[44m [m[38;5;130m[44m%2d[m[36m[44m/[m[38;5;130m[44m%p[m[36m[44m] [m[38;5;130m[44m%s[m[36m[44m"[m[91m[44m, ([m[32m[44mint[m[91m[44m)((([m[32m[44mint[m[91m[44m)id)%[m[38;5;130m[44m1000[m[91m[44m), tw ? tw->self : -[m[38;5;130m[44m9999[m[31;92H[34m[47m  [m[44m                                                                                       [m[32;92H[34m[47m  [m[93m[44m// RRN: TEMP: Using a simple concurrent queue implementation.  It would be better to us[m[33;92H[34m[47m  [m[91m[44m#define QUEUE_ELEMTY [m[92m[44mstruct[m[91m[44m __cilkrts_paused_stack[m[44m                                     [m[34;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_queue.h"[m[44m                                                          [m[35;92H[34m[47m  [m[91m[44m#undef QUEUE_ELEMTY[m[44m                                                                    [m[36;92H[34m[47m  [m[44m                                                                                       [m[37;92H[34m[47m  [m[91m[44m#if [m[38;5;248m[104mCILK[m[91m[44m_IVARS == [m[38;5;248m[104mCILK[m[91m[44m_IVARS_PTHREAD_VARIANT[m[44m                                           [m[38;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk_pthread.c"[m[44m                                                   [m[39;92H[34m[47m  [m[91m[44m#else[m[44m                                                                                  [m[40;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk.c"[m[44m                                                           [m[41;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[42;92H[34m[47m  [m[93m[44m// This function is a `yield` for defining coroutines.  It stops the current computatio[m[43;92H[34m[47m  [m[93m[44m// to a ready queue to be awoken after other tasks are given a chance to run.[m[44m          [m[44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [44;92H[34m[47m  [m[32m[44mvoid[m[44m __cilkrts_pause_a_bit([m[92m[44mstruct[m[44m __cilkrts_worker* w)                                 [m[45;92H[34m[47m  [m{[46;92H[34m[47m  [m[45m                                                                                       [m[47;92H[34m[47m  [m[45m  [m[1m[93m[41m// Here we do not need to save anything... the worker is left in place, but the threa[m[48;92H[34m[47m  [m[45m  [m[1m[93m[41m// Save the continuation in the top stack frame of the old (stalled) worker:[m[45m         [m[49;92H[34m[47m  [m[45m  [m[1m[32m[41mvolatile[m[1m[41m [m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack* ptr = ([m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack *) __cil[m[50;92H[34m[47m  [m[45m  [m[1m[41mIVAR_DBG_PRINT_([m[1m[38;5;130m[41m1[m[1m[41m,[m[1m[36m[41m" [scheduler: pause_a_bit] Creating paused stack: [m[1m[38;5;130m[41m%p[m[1m[36m[41m capturing curr[m[51;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m(ptr) {[m[45m                                                                            [m[52;92H[34m[47m  [m[45m    [m[1m[41m__cilkrts_wake_stack(ptr[m[45m);                                                         [m[53;164H[7m34[m[54;1H[K[53;75H[1m[7m1,[45;3H[?12l[?25h[?25l[m[1;1H[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                           [m
[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                         [m
[34m[47m  [m[44m                  SCHEDULE_WAIT,                                                        [m
[34m[47m  [m[44m                  SCHEDULE_EXIT };                                                      [m
[34m[47m  [m                                                                                        
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[93m[45m// [m[1m[93m[41mVerify that "w" is the worker we are currently executing on.[m[45m                         [m
[34m[47m  [m[1m[93m[41m// Because this check is expensive, this method is usually a no-op.[m[45m                     [m
[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[1m[32m[41minline[m[1m[41m [m[1m[32m[41mvoid[m[1m[41m verify_current_wkr(__cilkrts_worker *w)[m[45m                              [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m{                                                                                       
[34m[47m  [m[1m[91m[41m#if REDPAR_DEBUG >= [m[1m[38;5;130m[41m3[m[45m                                                                   [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[93m[41m// Lookup the worker from TLS and compare to w. [m[45m                                    [m
[34m[47m  [m[45m  [m[1m[41m  __cilkrts_worker* tmp = __cilkrts_get_tls_worker();[m[45m                                 [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (w != tmp) {[m[45m                                                                     [m
[34m[47m  [m[45m  [m[1m[41m      fprintf([m[1m[38;5;130m[41mstderr[m[1m[41m, [m[1m[36m[41m"Error.  W=[m[1m[38;5;130m[41m%d[m[1m[36m[41m, actual worker =[m[1m[38;5;130m[41m%d[m[1m[36m[41m...[m[1m[38;5;130m[41m\n[m[1m[36m[41m"[m[1m[41m,[m[45m                         [m
[34m[47m  [m[45m  [m[1m[41m              w->self,[m[45m                                                                [m
[34m[47m  [m[45m    [m[1m[41m            tmp->self[m[45m);                                                             [m
                                                                                          [34m[47m  [m[45m    [m[1m[41m}[m[45m                                                                                   [m[1;92H[34m[47m  [m[44m                                                                                       [m[2;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[3;92H[34m[47m  [m[44m  [m[93m[44m// Only system workers have a ready queue:[m[44m                                           [m[4;92H[34m[47m  [m[44m  [m[93m[44m//[m[44m                                                                                   [m[5;92H[34m[47m  [m[44m  [m[93m[44m// NOTE: In an earlier design there was a ready_queue here, but it has (temporarily?)[m[6;92H[34m[47m  [m[44m  [m[93m[44m// promoted to be global.[m[44m                                                            [m[7;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[8;92H[34m[47m  [m[44m}                                                                                      [m[9;92H[34m[47m  [m                                                                                       [10;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[11;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[12;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[13;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[14;92H[34m[47m  [m                                                                                       [15;92H[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_IVARS[m[44m                                                                      [m[16;92H[34m[47m  [m[93m[44m//   Header includes, macros, and other bits that should be filed away properly once[m[44m   [m[17;92H[34m[47m  [m[93m[44m//   Concurrent Cilk is fully integrated with the build system.[m[44m                        [m[18;92H[34m[47m  [m                                                                                       [19;92H[34m[47m  [m[93m[45m// [m[1m[93m[41mHelper used for debugging:[m[45m                                                          [m[20;92H[34m[47m  [m[1m[32m[41mvoid[m[1m[41m __cilkrts_show_threadid() {[m[45m                                                       [m[21;92H[34m[47m  [m[1m[41m  pthread_t id = pthread_self();[m[45m                                                       [m[22;92H[34m[47m  [m[44m  fprintf([m[38;5;130m[44mstderr[m[44m, [m[36m[44m"TID [m[38;5;130m[44m%lu[m[36m[44m "[m[44m, ([m[32m[44munsigned[m[44m [m[32m[44mlong[m[44m)id);                                      [m[23;92H[34m[47m  [m[44m}                                                                                      [m[24;92H[34m[47m  [m[44m                                                                                       [m[25;92H[34m[47m  [m[91m[44m#define IVAR_DBG_PRINT_(lvl, ...) [m[38;5;81m[44mif[m[91m[44m(IVAR_DBG >= lvl) {    \[m[44m                           [m[26;92H[34m[47m  [m[91m[44m  pthread_t id = pthread_self(); [m[32m[44mchar[m[91m[44m buf[[m[38;5;130m[44m512[m[91m[44m];             \[m[44m                          [m[27;92H[34m[47m  [m[91m[44m  sprintf(buf, __VA_ARGS__);                                \[m[44m                          [m[28;92H[34m[47m  [m[91m[44m  [m[32m[44mvolatile[m[91m[44m [m[92m[44mstruct[m[91m[44m __cilkrts_worker* tw = __cilkrts_get_tls_worker(); \[m[44m                 [m[29;92H[34m[47m  [m[91m[44m  fprintf([m[38;5;130m[44mstderr[m[91m[44m, [m[36m[44m"[tid/W [m[38;5;130m[44m%3d[m[36m[44m [m[38;5;130m[44m%2d[m[36m[44m/[m[38;5;130m[44m%p[m[36m[44m] [m[38;5;130m[44m%s[m[36m[44m"[m[91m[44m, ([m[32m[44mint[m[91m[44m)((([m[32m[44mint[m[91m[44m)id)%[m[38;5;130m[44m1000[m[91m[44m), tw ? tw->self : -[m[38;5;130m[44m9999[m[30;92H[34m[47m  [m[44m                                                                                       [m[31;92H[34m[47m  [m[93m[44m// RRN: TEMP: Using a simple concurrent queue implementation.  It would be better to us[m[32;92H[34m[47m  [m[91m[44m#define QUEUE_ELEMTY [m[92m[44mstruct[m[91m[44m __cilkrts_paused_stack[m[44m                                     [m[33;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_queue.h"[m[44m                                                          [m[34;92H[34m[47m  [m[91m[44m#undef QUEUE_ELEMTY[m[44m                                                                    [m[35;92H[34m[47m  [m[44m                                                                                       [m[36;92H[34m[47m  [m[91m[44m#if [m[38;5;248m[104mCILK[m[91m[44m_IVARS == [m[38;5;248m[104mCILK[m[91m[44m_IVARS_PTHREAD_VARIANT[m[44m                                           [m[37;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk_pthread.c"[m[44m                                                   [m[38;92H[34m[47m  [m[91m[44m#else[m[44m                                                                                  [m[39;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk.c"[m[44m                                                           [m[40;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[41;92H[34m[47m  [m[93m[44m// This function is a `yield` for defining coroutines.  It stops the current computatio[m[42;92H[34m[47m  [m[93m[44m// to a ready queue to be awoken after other tasks are given a chance to run.[m[44m          [m[43;92H[34m[47m  [m[32m[44mvoid[m[44m __cilkrts_pause_a_bit([m[92m[44mstruct[m[44m __cilkrts_worker* w)                                 [m[44;92H[34m[47m  [m{                                                                                      [45;92H[34m[47m  [m[45m                                                                                       [m[46;92H[34m[47m  [m[45m  [m[1m[93m[41m// Here we do not need to save anything... the worker is left in place, but the threa[m[47;92H[34m[47m  [m[45m  [m[1m[93m[41m// Save the continuation in the top stack frame of the old (stalled) worker:[m[45m         [m[48;92H[34m[47m  [m[45m  [m[1m[32m[41mvolatile[m[1m[41m [m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack* ptr = ([m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack *) __cil[m[49;92H[34m[47m  [m[45m  [m[1m[41mIVAR_DBG_PRINT_([m[1m[38;5;130m[41m1[m[1m[41m,[m[1m[36m[41m" [scheduler: pause_a_bit] Creating paused stack: [m[1m[38;5;130m[41m%p[m[1m[36m[41m capturing curr[m[50;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m(ptr) {[m[45m                                                                            [m[51;92H[34m[47m  [m[45m    [m[1m[41m__cilkrts_wake_stack(ptr[m[45m);                                                         [m[52;92H                                                                                         [52;92H[34m[47m  [m[45m    [m[1m[41m__cilkrts_finalize_pause(w,ptr);[m[45m                                                   [m[53;165H[7m5,0-1[m[53;75H[1m[7m2,[45;3H[?12l[?25h[?25l[m[54;1HType  :quit<Enter>  to exit Vim[45;3H[?12l[?25h[?25l[?12l[?25h[?25l[1;1H[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m{                                                                                       
[34m[47m  [m[1m[91m[41m#if REDPAR_DEBUG >= [m[1m[38;5;130m[41m3[m[45m                                                                   [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[93m[41m// Lookup the worker from TLS and compare to w. [m[45m                                    [m
[34m[47m  [m[45m  [m[1m[41m  __cilkrts_worker* tmp = __cilkrts_get_tls_worker();[m[45m                                 [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (w != tmp) {[m[45m                                                                     [m
[34m[47m  [m[45m  [m[1m[41m      fprintf([m[1m[38;5;130m[41mstderr[m[1m[41m, [m[1m[36m[41m"Error.  W=[m[1m[38;5;130m[41m%d[m[1m[36m[41m, actual worker =[m[1m[38;5;130m[41m%d[m[1m[36m[41m...[m[1m[38;5;130m[41m\n[m[1m[36m[41m"[m[1m[41m,[m[45m                         [m
[34m[47m  [m[45m  [m[1m[41m              w->self,[m[45m                                                                [m
[34m[47m  [m[45m    [m[1m[41m            tmp->self[m[45m);                                                             [m
[34m[47m  [m[45m    [m[1m[41m}[m[45m                                                                                   [m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [18;3H[46m{[m[27;1H[34m[47m  [m[45m  [m[1m[41m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(w == tmp);[m[45m                                                              [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[91m#endif[m
[34m[47m  [m[46m}[m[1m[41m                                                            [m[45m                           [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  
  [m[32mstatic[m [92menum[m schedule_t worker_runnable(__cilkrts_worker *w);
[34m[47m  
  [m[93m// Scheduling-stack functions:[m
[34m[47m  [m[32mstatic[m [32mvoid[m do_return_from_spawn (__cilkrts_worker *w,
[34m[47m  [m[45m    [m[1m[41m                              full_frame *f[m[45mf,                                       [m
[34m[47m  [m[45m    [m[1m[41m                              [m[45m__cilkrts_stack_frame *sf);                           [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[32mstatic[m [32mvoid[m do_sync (__cilkrts_worker *w,
[34m[47m  [m[45m    [m[1m[41m                 full_frame *f[m[45mf,                                                    [m
[34m[47m  [m[45m    [m[1m[41m                 [m[45m__cilkrts_stack_frame *sf);                                        [m
[34m[47m  
  [m[91m#ifndef _WIN32[m
[34m[47m  [m[1m[41m    [m[93m[45m// TBD: definition of max() for Linux.[m[45m                                              [m[1;92H[34m[47m  [m[91m[44m  sprintf(buf, __VA_ARGS__);                                \[m[44m                          [m[2;92H[34m[47m  [m[91m[44m  [m[32m[44mvolatile[m[91m[44m [m[92m[44mstruct[m[91m[44m __cilkrts_worker* tw = __cilkrts_get_tls_worker(); \[m[44m                 [m[3;92H[34m[47m  [m[91m[44m  fprintf([m[38;5;130m[44mstderr[m[91m[44m, [m[36m[44m"[tid/W [m[38;5;130m[44m%3d[m[36m[44m [m[38;5;130m[44m%2d[m[36m[44m/[m[38;5;130m[44m%p[m[36m[44m] [m[38;5;130m[44m%s[m[36m[44m"[m[91m[44m, ([m[32m[44mint[m[91m[44m)((([m[32m[44mint[m[91m[44m)id)%[m[38;5;130m[44m1000[m[91m[44m), tw ? tw->self : -[m[38;5;130m[44m9999[m[4;92H[34m[47m  [m[44m                                                                                       [m[5;92H[34m[47m  [m[93m[44m// RRN: TEMP: Using a simple concurrent queue implementation.  It would be better to us[m[6;92H[34m[47m  [m[91m[44m#define QUEUE_ELEMTY [m[92m[44mstruct[m[91m[44m __cilkrts_paused_stack[m[44m                                     [m[7;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_queue.h"[m[44m                                                          [m[8;92H[34m[47m  [m[91m[44m#undef QUEUE_ELEMTY[m[44m                                                                    [m[9;92H[34m[47m  [m[44m                                                                                       [m[10;92H[34m[47m  [m[91m[44m#if [m[38;5;248m[104mCILK[m[91m[44m_IVARS == [m[38;5;248m[104mCILK[m[91m[44m_IVARS_PTHREAD_VARIANT[m[44m                                           [m[11;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk_pthread.c"[m[44m                                                   [m[12;92H[34m[47m  [m[91m[44m#else[m[44m                                                                                  [m[13;92H[34m[47m  [m[91m[44m#include [m[36m[44m"concurrent_cilk.c"[m[44m                                                           [m[14;92H[34m[47m  [m[91m[44m#endif[m[44m                                                                                 [m[15;92H[34m[47m  [m[93m[44m// This function is a `yield` for defining coroutines.  It stops the current computatio[m[16;92H[34m[47m  [m[93m[44m// to a ready queue to be awoken after other tasks are given a chance to run.[m[44m          [m[17;92H[34m[47m  [m[32m[44mvoid[m[44m __cilkrts_pause_a_bit([m[92m[44mstruct[m[44m __cilkrts_worker* w)                                 [m[18;92H[34m[47m  [m{                                                                                      [19;92H[34m[47m  [m[45m                                                                                       [m[20;92H[34m[47m  [m[45m  [m[1m[93m[41m// Here we do not need to save anything... the worker is left in place, but the threa[m[21;92H[34m[47m  [m[45m  [m[1m[93m[41m// Save the continuation in the top stack frame of the old (stalled) worker:[m[45m         [m[22;92H[34m[47m  [m[45m  [m[1m[32m[41mvolatile[m[1m[41m [m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack* ptr = ([m[1m[92m[41mstruct[m[1m[41m __cilkrts_paused_stack *) __cil[m[23;92H[34m[47m  [m[45m  [m[1m[41mIVAR_DBG_PRINT_([m[1m[38;5;130m[41m1[m[1m[41m,[m[1m[36m[41m" [scheduler: pause_a_bit] Creating paused stack: [m[1m[38;5;130m[41m%p[m[1m[36m[41m capturing curr[m[24;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m(ptr) {[m[45m                                                                            [m[25;92H[34m[47m  [m[45m    [m[1m[41m__cilkrts_wake_stack(ptr[m[45m);                                                         [m[26;92H[34m[47m  [m[45m    [m[1m[41m__cilkrts_finalize_pause(w,ptr);[m[45m                                                   [m[27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m[45m  [m[1m[41m}[m[45m                                                                                    [m[28;92H[34m[47m  [m[44m}                                                                                      [m[29;92H[34m[47m  [m[91m#endif[m[30;92H[34m[47m  [m[45m                                                                                       [m[31;92H[34m[47m  [m[93m[44m//end insert[m[44m                                                                           [m[32;92H[34m[47m  [m[44m                                                                                       [m[33;92H[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                          [m[34;92H[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                        [m[35;92H[34m[47m  [m[44m  SCHEDULE_WAIT,                                                                       [m[36;92H[34m[47m  [m[44m  SCHEDULE_EXIT };                                                                     [m[37;92H[34m[47m  [38;92H  [m[32mstatic[m [92menum[m schedule_t worker_runnable(__cilkrts_worker *w);[39;92H[34m[47m  [40;92H  [m[93m// Scheduling-stack functions:[m[41;92H[34m[47m  [m[32mstatic[m [32mvoid[m do_return_from_spawn (__cilkrts_worker *w,[42;92H[34m[47m  [m[45m    [m[1m[41mfull_frame *[m[45mf,                                                                     [m[43;92H[34m[47m  [m[45m    __cilkrts_stack_frame *sf);                                                        [m[44;92H[34m[47m  [m[32m[44mstatic[m[44m [m[32m[44mvoid[m[44m do_migrate_exception (__cilkrts_worker *w,                                 [m[45;92H[34m[47m  [m[44m    full_frame *f,                                                                     [m[46;92H[34m[47m  [m[44m    __cilkrts_stack_frame *sf);                                                        [m[47;92H[34m[47m  [m[32mstatic[m [32mvoid[m do_sync (__cilkrts_worker *w,[48;92H[34m[47m  [m[45m    [m[1m[41mfull_frame *[m[45mf,                                                                     [m[49;92H[34m[47m  [m[45m    __cilkrts_stack_frame *sf);                                                        [m[50;92H[34m[47m  [51;92H  [m[91m#ifndef _WIN32[m[52;92H[34m[47m  [m[93m[45m// TBD: definition of max() for Linux.[m[45m                                                 [m[53;164H[7m46[13C4[m[54;1H[K[53;74H[1m[7m12[13C3%[30;3H[?12l[?25h[?25l[m[1;1H[34m[47m  [m[45m  [m[1m[41m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(w == tmp);[m[45m                                                              [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[91m#endif[m                                                                                  
[34m[47m  [m[46m}[m[1m[41m                                                            [m[45m                           [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m                                                                                        
[34m[47m  [m[32mstatic[m [92menum[m schedule_t worker_runnable(__cilkrts_worker *w);                            
[34m[47m  [m                                                                                        
[34m[47m  [m[93m// Scheduling-stack functions:[m                                                          
[34m[47m  [m[32mstatic[m [32mvoid[m do_return_from_spawn (__cilkrts_worker *w,                                  
[34m[47m  [m[45m    [m[1m[41m                              full_frame *f[m[45mf,                                       [m
[34m[47m  [m[45m    [m[1m[41m                              [m[45m__cilkrts_stack_frame *sf);                           [m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[1m[34m[46m----------------------------------------------------------------------------------------[m
[34m[47m  [m[32mstatic[m [32mvoid[m do_sync (__cilkrts_worker *w,                                               
[34m[47m  [m[45m    [m[1m[41m                 full_frame *f[m[45mf,                                                    [m
[34m[47m  [m[45m    [m[1m[41m                 [m[45m__cilkrts_stack_frame *sf);                                        [m
[34m[47m  [m                                                                                        
[34m[47m  [m[91m#ifndef _WIN32[m                                                                          
[34m[47m  [m[1m[41m    [m[93m[45m// TBD: definition of max() for Linux.[m[45m                                              [m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [4;3H[1m[41m}[m[27;1H[34m[47m  [m[91m#   define max(a, b) ((a) < (b) ? (b) : (a))[m
[34m[47m  [m[91m#endif[m
[34m[47m  
  [m[32m[45mvoid[m[45m __cilkrts_dump_stats_to_stderr(global_state_t *g)                                  [m
[34m[47m  [m{
[34m[47m  [m[91m#ifdef [m[38;5;248m[104mCILK[m[91m_PROFILE[m
[34m[47m  [m[45m  [m[1m[41m  [m[32m[45mint[m[45m i;                                                                              [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;81m[45mfor[m[45m (i = [m[38;5;130m[45m0[m[45m; i < g->total_workers; ++i)                                              [m
[34m[47m  [m[45m    [m[1m[41m    [m[45m__cilkrts_accum_stats(&g->stats, &g->workers[i]->l->stats);                     [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mdump_stats_to_file([m[38;5;130m[45mstderr[m[45m, &g->stats);                                              [m
[34m[47m  [m[91m[45m#endif[m[45m                                                                                  [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mfprintf([m[38;5;130m[45mstderr[m[45m,                                                                     [m
[34m[47m  [m[45m      [m[1m[41m      [m[1m[36m[41m"[m[38;5;248m[104mCILK[m[1m[36m[41m PLUS Thread Info: P=[m[1m[38;5;130m[41m%d[m[1m[36m[41m, Q=[m[1m[38;5;130m[41m%d\n[m[36m[45m"[m[45m,                                      [m
[34m[47m  [m[45m      [m[1m[41m      g->P,[m[45m                                                                       [m
[34m[47m  [m[45m  [m[1m[41m          g->Q);[m[45m                                                                      [m
[34m[47m  [m[45m    fprintf([m[38;5;130m[45mstderr[m[45m,                                                                     [m
[34m[47m  [m[45m  [m[1m[41m          [m[1m[36m[41m"[m[38;5;248m[104mCILK[m[1m[36m[41m PLUS RUNTIME MEMORY USAGE: [m[1m[38;5;130m[41m%lld[m[1m[36m[41m bytes"[m[1m[41m,[m[45m                               [m
[34m[47m  [m[44m            ([m[32m[44mlong[m[44m [m[32m[44mlong[m[44m)g->frame_malloc.allocated_from_os);                              [m
[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_PROFILE[m[44m                                                                     [m
[34m[47m  [m[44m    [m[38;5;81m[44mif[m[44m (g->stats.stack_hwm)                                                             [m
[34m[47m  [m[44m        fprintf([m[38;5;130m[44mstderr[m[44m, [m[36m[44m", [m[38;5;130m[44m%ld[m[36m[44m stacks"[m[44m, g->stats.stack_hwm);                            [m
[34m[47m  [m[91m[44m#endif[m[44m                                                                                  [m
[34m[47m  [m    fputc([38;5;130m'\n'[m, [38;5;130mstderr[m);
[34m[47m  [m}
[34m[47m  
  [m[1m[32m[41mstatic[m[45m [m[32m[45mvoid[m[45m validate_worker(__cilkrts_worker *w)                                        [m[1;92H[34m[47m  [m[45m  [m[1m[41m}[m[45m                                                                                    [m[2;92H[34m[47m  [m[44m}                                                                                      [m[3;92H[34m[47m  [m[91m#endif[m                                                                                 [4;92H[34m[47m  [m[45m                                                                                       [m[5;92H[34m[47m  [m[93m[44m//end insert[m[44m                                                                           [m[6;92H[34m[47m  [m[44m                                                                                       [m[7;92H[34m[47m  [m[93m[44m// Options for the scheduler.[m[44m                                                          [m[8;92H[34m[47m  [m[92m[44menum[m[44m schedule_t { SCHEDULE_RUN,                                                        [m[9;92H[34m[47m  [m[44m  SCHEDULE_WAIT,                                                                       [m[10;92H[34m[47m  [m[44m  SCHEDULE_EXIT };                                                                     [m[11;92H[34m[47m  [m                                                                                       [12;92H[34m[47m  [m[32mstatic[m [92menum[m schedule_t worker_runnable(__cilkrts_worker *w);                           [13;92H[34m[47m  [m                                                                                       [14;92H[34m[47m  [m[93m// Scheduling-stack functions:[m                                                         [15;92H[34m[47m  [m[32mstatic[m [32mvoid[m do_return_from_spawn (__cilkrts_worker *w,                                 [16;92H[34m[47m  [m[45m    [m[1m[41mfull_frame *[m[45mf,                                                                     [m[17;92H[34m[47m  [m[45m    __cilkrts_stack_frame *sf);                                                        [m[18;92H[34m[47m  [m[32m[44mstatic[m[44m [m[32m[44mvoid[m[44m do_migrate_exception (__cilkrts_worker *w,                                 [m[19;92H[34m[47m  [m[44m    full_frame *f,                                                                     [m[20;92H[34m[47m  [m[44m    __cilkrts_stack_frame *sf);                                                        [m[21;92H[34m[47m  [m[32mstatic[m [32mvoid[m do_sync (__cilkrts_worker *w,                                              [22;92H[34m[47m  [m[45m    [m[1m[41mfull_frame *[m[45mf,                                                                     [m[23;92H[34m[47m  [m[45m    __cilkrts_stack_frame *sf);                                                        [m[24;92H[34m[47m  [m                                                                                       [25;92H[34m[47m  [m[91m#ifndef _WIN32[m                                                                         [26;92H[34m[47m  [m[93m[45m// TBD: definition of max() for Linux.[m[45m                                                 [m[27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m[91m#   define max(a, b) ((a) < (b) ? (b) : (a))[m[28;92H[34m[47m  [m[91m#endif[m[29;92H[34m[47m  [30;92H  [m[1m[32m[41mstatic[m[1m[41m [m[32m[45mvoid[m[45m __cilkrts_dump_stats_to_stderr(global_state_t *g)                          [m[31;92H[34m[47m  [m{[32;92H[34m[47m  [m[91m#ifdef [m[38;5;248m[104mCILK[m[91m_PROFILE[m[33;92H[34m[47m  [m[45m  [m[32m[45mint[m[45m i;                                                                               [m[34;92H[34m[47m  [m[45m  [m[38;5;81m[45mfor[m[45m (i = [m[38;5;130m[45m0[m[45m; i < g->total_workers; ++i)                                               [m[35;92H[34m[47m  [m[45m    __cilkrts_accum_stats(&g->stats, &g->workers[i]->l->stats);                        [m[36;92H[34m[47m  [m[45m  dump_stats_to_file([m[38;5;130m[45mstderr[m[45m, &g->stats);                                               [m[37;92H[34m[47m  [m[91m[45m#endif[m[45m                                                                                 [m[38;92H[34m[47m  [m[45m  fprintf([m[38;5;130m[45mstderr[m[45m,                                                                      [m[39;92H[34m[47m  [m[45m      [m[1m[36m[41m"[m[1m[38;5;130m[41m\n[m[38;5;248m[104mCILK[m[1m[36m[41m++ RUNTIME MEMORY USAGE: [m[1m[38;5;130m[41m%lld[m[1m[36m[41m bytes[m[36m[45m"[m[45m,                                     [m[40;92H[34m[47m  [m[45m      [m[1m[41m([m[1m[32m[41mlong[m[1m[41m [m[1m[32m[41mlong[m[1m[41m)g->frame_malloc.allocated_from_os);[m[45m                                   [m[41;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (g->stats.stack_hwm)[m[45m                                                              [m[42;92H[34m[47m  [m[45m    fprintf([m[38;5;130m[45mstderr[m[45m,[m[1m[41m [m[1m[36m[41m", [m[1m[38;5;130m[41m%ld[m[1m[36m[41m stacks[m[1m[38;5;130m[41m\n[m[1m[36m[41m"[m[1m[41m, g->stats.stack_hwm);[m[45m                             [m[43;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41melse[m[45m                                                                                 [m[44;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[45;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[46;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[47;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[48;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[49;92H[34m[47m  [m    fputc([38;5;130m'\n'[m, [38;5;130mstderr[m);[50;92H[34m[47m  [m}[51;92H[34m[47m  [52;92H  [m[45m [m[32m[45mvoid[m[45m validate_worker(__cilkrts_worker *w)                                             [m[53;164H[7m64,19 [9C5[m[53;74H[1m[7m21,22[22;24H[?12l[?25h[?25l[m[1;1H[34m[47m  [m[91m#   define max(a, b) ((a) < (b) ? (b) : (a))[m                                            
[34m[47m  [m[91m#endif[m                                                                                  
[34m[47m  [m                                                                                        
[34m[47m  [m[32m[45mvoid[m[45m __cilkrts_dump_stats_to_stderr(global_state_t *g)                                  [m
[34m[47m  [m{                                                                                       
[34m[47m  [m[91m#ifdef [m[38;5;248m[104mCILK[m[91m_PROFILE[m                                                                     
[34m[47m  [m[45m  [m[1m[41m  [m[32m[45mint[m[45m i;                                                                              [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;81m[45mfor[m[45m (i = [m[38;5;130m[45m0[m[45m; i < g->total_workers; ++i)                                              [m
[34m[47m  [m[45m    [m[1m[41m    [m[45m__cilkrts_accum_stats(&g->stats, &g->workers[i]->l->stats);                     [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mdump_stats_to_file([m[38;5;130m[45mstderr[m[45m, &g->stats);                                              [m
[34m[47m  [m[91m[45m#endif[m[45m                                                                                  [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mfprintf([m[38;5;130m[45mstderr[m[45m,                                                                     [m
[34m[47m  [m[45m      [m[1m[41m      [m[1m[36m[41m"[m[38;5;248m[104mCILK[m[1m[36m[41m PLUS Thread Info: P=[m[1m[38;5;130m[41m%d[m[1m[36m[41m, Q=[m[1m[38;5;130m[41m%d\n[m[36m[45m"[m[45m,                                      [m
[34m[47m  [m[45m      [m[1m[41m      g->P,[m[45m                                                                       [m
[34m[47m  [m[45m  [m[1m[41m          g->Q);[m[45m                                                                      [m
[34m[47m  [m[45m    fprintf([m[38;5;130m[45mstderr[m[45m,                                                                     [m
[34m[47m  [m[45m  [m[1m[41m          [m[1m[36m[41m"[m[38;5;248m[104mCILK[m[1m[36m[41m PLUS RUNTIME MEMORY USAGE: [m[1m[38;5;130m[41m%lld[m[1m[36m[41m bytes"[m[1m[41m,[m[45m                               [m
[34m[47m  [m[44m            ([m[32m[44mlong[m[44m [m[32m[44mlong[m[44m)g->frame_malloc.allocated_from_os);                              [m
[34m[47m  [m[91m[44m#ifdef [m[38;5;248m[104mCILK[m[91m[44m_PROFILE[m[44m                                                                     [m
[34m[47m  [m[44m    [m[38;5;81m[44mif[m[44m (g->stats.stack_hwm)                                                             [m
[34m[47m  [m[44m        fprintf([m[38;5;130m[44mstderr[m[44m, [m[36m[44m", [m[38;5;130m[44m%ld[m[36m[44m stacks"[m[44m, g->stats.stack_hwm);                            [m
[34m[47m  [m[91m[44m#endif[m[44m                                                                                  [m
[34m[47m  [m    fputc([38;5;130m'\n'[m, [38;5;130mstderr[m);                                                                
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[1m[32m[41mstatic[m[45m [m[32m[45mvoid[m[45m validate_worker(__cilkrts_worker *w)                                        [m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [27;1H[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[93m[45m/* check the magic numbers, for debugging purposes */[m[45m                               [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;81m[45mif[m[45m (w->l->worker_magic_0 != WORKER_MAGIC_0 ||                                       [m
[34m[47m  [m[45m      [m[1m[41m  [m[45mw->l->worker_magic_1 != WORKER_MAGIC_1)                                         [m
[34m[47m  [m[45m    [m[1m[41m    [m[45mabort_because_rts_is_corrupted();                                               [m
[34m[47m  [m}
[34m[47m  
  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m double_link(full_frame *left[m[1m[41m_ff, full_frame *right_ff[m[45m)                      [m
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (left_ff[m[45m)                                                                        [m
[34m[47m  [m[45m    [m[1m[41m    left_ff->right_sibling = right_ff[m[45m;                                              [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (right_ff[m[45m)                                                                       [m
[34m[47m  [m[45m    [m[1m[41m    right_ff->left_sibling = left_ff[m[45m;                                               [m
[34m[47m  [m}
[34m[47m  
  [m[93m/* add CHILD to the right of all children of PARENT */[m
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m push_child(full_frame *parent[m[1m[41m_ff, full_frame *child_ff[m[45m)                     [m
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  double_link(parent_ff->rightmost_child, child_ff[m[45m);                                  [m
[34m[47m  [m[45m  [m[1m[41m  double_link(child_ff[m[45m, [m[38;5;130m[45m0[m[45m);                                                           [m
[34m[47m  [m[45m  [m[1m[41m  parent_ff->rightmost_child = child_ff[m[45m;                                              [m
[34m[47m  [m}
[34m[47m  
  [m[93m/* unlink CHILD from the list of all children of PARENT */[m
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m unlink_child(full_frame *parent[m[1m[41m_ff, full_frame *child_ff[m[45m)                   [m
[34m[47m  [m{[1;92H[34m[47m  [m[91m#   define max(a, b) ((a) < (b) ? (b) : (a))[m                                           [2;92H[34m[47m  [m[91m#endif[m                                                                                 [3;92H[34m[47m  [m                                                                                       [4;92H[34m[47m  [m[1m[32m[41mstatic[m[1m[41m [m[32m[45mvoid[m[45m __cilkrts_dump_stats_to_stderr(global_state_t *g)                          [m[5;92H[34m[47m  [m{                                                                                      [6;92H[34m[47m  [m[91m#ifdef [m[38;5;248m[104mCILK[m[91m_PROFILE[m                                                                    [7;92H[34m[47m  [m[45m  [m[32m[45mint[m[45m i;                                                                               [m[8;92H[34m[47m  [m[45m  [m[38;5;81m[45mfor[m[45m (i = [m[38;5;130m[45m0[m[45m; i < g->total_workers; ++i)                                               [m[9;92H[34m[47m  [m[45m    __cilkrts_accum_stats(&g->stats, &g->workers[i]->l->stats);                        [m[10;92H[34m[47m  [m[45m  dump_stats_to_file([m[38;5;130m[45mstderr[m[45m, &g->stats);                                               [m[11;92H[34m[47m  [m[91m[45m#endif[m[45m                                                                                 [m[12;92H[34m[47m  [m[45m  fprintf([m[38;5;130m[45mstderr[m[45m,                                                                      [m[13;92H[34m[47m  [m[45m      [m[1m[36m[41m"[m[1m[38;5;130m[41m\n[m[38;5;248m[104mCILK[m[1m[36m[41m++ RUNTIME MEMORY USAGE: [m[1m[38;5;130m[41m%lld[m[1m[36m[41m bytes[m[36m[45m"[m[45m,                                     [m[14;92H[34m[47m  [m[45m      [m[1m[41m([m[1m[32m[41mlong[m[1m[41m [m[1m[32m[41mlong[m[1m[41m)g->frame_malloc.allocated_from_os);[m[45m                                   [m[15;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (g->stats.stack_hwm)[m[45m                                                              [m[16;92H[34m[47m  [m[45m    fprintf([m[38;5;130m[45mstderr[m[45m,[m[1m[41m [m[1m[36m[41m", [m[1m[38;5;130m[41m%ld[m[1m[36m[41m stacks[m[1m[38;5;130m[41m\n[m[1m[36m[41m"[m[1m[41m, g->stats.stack_hwm);[m[45m                             [m[17;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41melse[m[45m                                                                                 [m[18;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[19;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[20;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[21;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[22;92H[34m[47m  [m[1m[34m[46m---------------------------------------------------------------------------------------[m[23;92H[34m[47m  [m    fputc([38;5;130m'\n'[m, [38;5;130mstderr[m);                                                               [24;92H[34m[47m  [m}                                                                                      [25;92H[34m[47m  [m                                                                                       [26;92H[34m[47m  [m[45m [m[32m[45mvoid[m[45m validate_worker(__cilkrts_worker *w)                                             [m[27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m{[28;92H[34m[47m  [m[45m  [m[93m[45m/* check the magic numbers, for debugging purposes */[m[45m                                [m[29;92H[34m[47m  [m[45m  [m[38;5;81m[45mif[m[45m (w->l->worker_magic_0 != WORKER_MAGIC_0 ||                                        [m[30;92H[34m[47m  [m[45m      w->l->worker_magic_1 != WORKER_MAGIC_1)                                          [m[31;92H[34m[47m  [m[45m    abort_because_rts_is_corrupted();                                                  [m[32;92H[34m[47m  [m}[33;92H[34m[47m  [34;92H  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m double_link(full_frame *left[m[1m[41m, full_frame *right[m[45m)                           [m[35;92H[34m[47m  [m{[36;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (left[m[45m)                                                                            [m[37;92H[34m[47m  [m[45m    [m[1m[41mleft->right_sibling = right[m[45m;                                                       [m[38;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (right[m[45m)                                                                           [m[39;92H[34m[47m  [m[45m    [m[1m[41mright->left_sibling = left[m[45m;                                                        [m[40;92H[34m[47m  [m}[41;92H[34m[47m  [42;92H  [m[93m/* add CHILD to the right of all children of PARENT */[m[43;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m push_child(full_frame *parent[m[1m[41m, full_frame *child[m[45m)                          [m[44;92H[34m[47m  [m{[45;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(parent->rightmost_child, child[m[45m);                                         [m[46;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(child[m[45m, [m[38;5;130m[45m0[m[45m);                                                               [m[47;92H[34m[47m  [m[45m  [m[1m[41mparent->rightmost_child = child[m[45m;                                                     [m[48;92H[34m[47m  [m}[49;92H[34m[47m  [50;92H  [m[93m/* unlink CHILD from the list of all children of PARENT */[m[51;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m unlink_child(full_frame *parent[m[1m[41m, full_frame *child[m[45m)                        [m[52;92H[34m[47m  [m{[53;164H[7m80,5 [10C6[m[53;74H[1m[7m37,5  [12;7H[?12l[?25h[?25l[m[1;1H[34m[47m  [m{                                                                                       
[34m[47m  [m[45m  [m[1m[41m  [m[93m[45m/* check the magic numbers, for debugging purposes */[m[45m                               [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;81m[45mif[m[45m (w->l->worker_magic_0 != WORKER_MAGIC_0 ||                                       [m
[34m[47m  [m[45m      [m[1m[41m  [m[45mw->l->worker_magic_1 != WORKER_MAGIC_1)                                         [m
[34m[47m  [m[45m    [m[1m[41m    [m[45mabort_because_rts_is_corrupted();                                               [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m double_link(full_frame *left[m[1m[41m_ff, full_frame *right_ff[m[45m)                      [m
[34m[47m  [m{                                                                                       
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (left_ff[m[45m)                                                                        [m
[34m[47m  [m[45m    [m[1m[41m    left_ff->right_sibling = right_ff[m[45m;                                              [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (right_ff[m[45m)                                                                       [m
[34m[47m  [m[45m    [m[1m[41m    right_ff->left_sibling = left_ff[m[45m;                                               [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[93m/* add CHILD to the right of all children of PARENT */[m                                  
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m push_child(full_frame *parent[m[1m[41m_ff, full_frame *child_ff[m[45m)                     [m
[34m[47m  [m{                                                                                       
[34m[47m  [m[45m  [m[1m[41m  double_link(parent_ff->rightmost_child, child_ff[m[45m);                                  [m
[34m[47m  [m[45m  [m[1m[41m  double_link(child_ff[m[45m, [m[38;5;130m[45m0[m[45m);                                                           [m
[34m[47m  [m[45m  [m[1m[41m  parent_ff->rightmost_child = child_ff[m[45m;                                              [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[93m/* unlink CHILD from the list of all children of PARENT */[m                              
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m unlink_child(full_frame *parent[m[1m[41m_ff, full_frame *child_ff[m[45m)                   [m
[34m[47m  [m{                                                                                       
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [27;1H[34m[47m  [m[45m  [m[1m[41m  double_link(child_ff->left_sibling, child_ff[m[45m->right_sibling);                       [m
[34m[47m  
  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (!child_ff[m[45m->right_sibling) {                                                     [m
[34m[47m  [m[45m    [m[1m[41m    [m[93m[45m/* this is the rightmost child -- update parent link */[m[45m                         [m
[34m[47m  [m[45m    [m[1m[41m    [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(parent_ff->rightmost_child == child_ff[m[45m);                            [m
[34m[47m  [m[45m    [m[1m[41m    parent_ff->rightmost_child = child_ff[m[45m->left_sibling;                            [m
[34m[47m  [m[45m  [m[1m[41m  [m[45m}                                                                                   [m
[34m[47m  [m[45m  [m[1m[41m  child_ff->left_sibling = child_ff[m[45m->right_sibling = [m[38;5;130m[45m0[m[45m; [m[93m[45m/* paranoia */[m[45m                [m
[34m[47m  [m}
[34m[47m  
  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m incjoin(full_frame *f[m[1m[41mf[m[45m)                                                     [m
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  ++f[m[45mf->join_counter;                                                                 [m
[34m[47m  [m}
[34m[47m  
  [m[32m[45mstatic[m[45m [m[32m[45mint[m[45m decjoin(full_frame *f[m[1m[41mf[m[45m)                                                      [m
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(f[m[45mf->join_counter > [m[38;5;130m[45m0[m[45m);                                                  [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mreturn[m[1m[41m (--f[m[45mf->join_counter);                                                        [m
[34m[47m  [m}
[34m[47m  
  [m[93m/*[m
[34m[47m  [m[93m * Pseudo-random generator defined by the congruence S' = 69070 * S[m
[34m[47m  [m[93m * mod (2^32 - 5).  Marsaglia (CACM July 1993) says on page 107 that[m
[34m[47m  [m[93m * this is a ``good one''.  There you go.[m
[34m[47m+ [m[38;5;248m[48;5;242m+--  3 lines: *-------------------------------------------------------------------------[m[1;92H[34m[47m  [m{                                                                                      [2;92H[34m[47m  [m[45m  [m[93m[45m/* check the magic numbers, for debugging purposes */[m[45m                                [m[3;92H[34m[47m  [m[45m  [m[38;5;81m[45mif[m[45m (w->l->worker_magic_0 != WORKER_MAGIC_0 ||                                        [m[4;92H[34m[47m  [m[45m      w->l->worker_magic_1 != WORKER_MAGIC_1)                                          [m[5;92H[34m[47m  [m[45m    abort_because_rts_is_corrupted();                                                  [m[6;92H[34m[47m  [m}                                                                                      [7;92H[34m[47m  [m                                                                                       [8;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m double_link(full_frame *left[m[1m[41m, full_frame *right[m[45m)                           [m[9;92H[34m[47m  [m{                                                                                      [10;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (left[m[45m)                                                                            [m[11;92H[34m[47m  [m[45m    [m[1m[41mleft->right_sibling = right[m[45m;                                                       [m[12;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (right[m[45m)                                                                           [m[13;92H[34m[47m  [m[45m    [m[1m[41mright->left_sibling = left[m[45m;                                                        [m[14;92H[34m[47m  [m}                                                                                      [15;92H[34m[47m  [m                                                                                       [16;92H[34m[47m  [m[93m/* add CHILD to the right of all children of PARENT */[m                                 [17;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m push_child(full_frame *parent[m[1m[41m, full_frame *child[m[45m)                          [m[18;92H[34m[47m  [m{                                                                                      [19;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(parent->rightmost_child, child[m[45m);                                         [m[20;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(child[m[45m, [m[38;5;130m[45m0[m[45m);                                                               [m[21;92H[34m[47m  [m[45m  [m[1m[41mparent->rightmost_child = child[m[45m;                                                     [m[22;92H[34m[47m  [m}                                                                                      [23;92H[34m[47m  [m                                                                                       [24;92H[34m[47m  [m[93m/* unlink CHILD from the list of all children of PARENT */[m                             [25;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m unlink_child(full_frame *parent[m[1m[41m, full_frame *child[m[45m)                        [m[26;92H[34m[47m  [m{                                                                                      [27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(child->left_sibling, child[m[45m->right_sibling);                              [m[28;92H[34m[47m  [29;92H  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (!child[m[45m->right_sibling) {                                                         [m[30;92H[34m[47m  [m[45m    [m[93m[45m/* this is the rightmost child -- update parent link */[m[45m                            [m[31;92H[34m[47m  [m[45m    [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(parent->rightmost_child == child[m[45m);                                     [m[32;92H[34m[47m  [m[45m    [m[1m[41mparent->rightmost_child = child[m[45m->left_sibling;                                     [m[33;92H[34m[47m  [m[45m  }                                                                                    [m[34;92H[34m[47m  [m[45m  [m[1m[41mchild->left_sibling = child[m[45m->right_sibling = [m[38;5;130m[45m0[m[45m; [m[93m[45m/* paranoia */[m[45m                       [m[35;92H[34m[47m  [m}[36;92H[34m[47m  [37;92H  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m incjoin(full_frame *f)                                                     [m[38;92H[34m[47m  [m{[39;92H[34m[47m  [m[45m  [m[1m[41m++[m[45mf->join_counter;                                                                   [m[40;92H[34m[47m  [m}[41;92H[34m[47m  [42;92H  [m[32m[45mstatic[m[45m [m[32m[45mint[m[45m decjoin(full_frame *f)                                                      [m[43;92H[34m[47m  [m{[44;92H[34m[47m  [m[45m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT([m[45mf->join_counter > [m[38;5;130m[45m0[m[45m);                                                    [m[45;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mreturn[m[1m[41m (--[m[45mf->join_counter);                                                          [m[46;92H[34m[47m  [m}[47;92H[34m[47m  [48;92H  [m[93m/*[m[49;92H[34m[47m  [m[93m * Pseudo-random generator defined by the congruence S' = 69070 * S[m[50;92H[34m[47m  [m[93m * mod (2^32 - 5).  Marsaglia (CACM July 1993) says on page 107 that[m[51;92H[34m[47m  [m[93m * this is a ``good one''.  There you go.[m[52;92H[34m[47m+ [m[38;5;248m[48;5;242m+--  3 lines: *------------------------------------------------------------------------[m[53;163H[7m201[13C7[m[53;74H[1m[7m63,[12C4%[12;7H[?12l[?25h[?25l[m[1;1H[34m[47m  [m[45m  [m[1m[41m  double_link(child_ff->left_sibling, child_ff[m[45m->right_sibling);                       [m
[34m[47m  [m                                                                                        
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mif[m[1m[41m (!child_ff[m[45m->right_sibling) {                                                     [m
[34m[47m  [m[45m    [m[1m[41m    [m[93m[45m/* this is the rightmost child -- update parent link */[m[45m                         [m
[34m[47m  [m[45m    [m[1m[41m    [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(parent_ff->rightmost_child == child_ff[m[45m);                            [m
[34m[47m  [m[45m    [m[1m[41m    parent_ff->rightmost_child = child_ff[m[45m->left_sibling;                            [m
[34m[47m  [m[45m  [m[1m[41m  [m[45m}                                                                                   [m
[34m[47m  [m[45m  [m[1m[41m  child_ff->left_sibling = child_ff[m[45m->right_sibling = [m[38;5;130m[45m0[m[45m; [m[93m[45m/* paranoia */[m[45m                [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m incjoin(full_frame *f[m[1m[41mf[m[45m)                                                     [m
[34m[47m  [m{                                                                                       
[34m[47m  [m[45m  [m[1m[41m  ++f[m[45mf->join_counter;                                                                 [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mint[m[45m decjoin(full_frame *f[m[1m[41mf[m[45m)                                                      [m
[34m[47m  [m{                                                                                       
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(f[m[45mf->join_counter > [m[38;5;130m[45m0[m[45m);                                                  [m
[34m[47m  [m[45m  [m[1m[41m  [m[1m[38;5;81m[41mreturn[m[1m[41m (--f[m[45mf->join_counter);                                                        [m
[34m[47m  [m}                                                                                       
[34m[47m  [m                                                                                        
[34m[47m  [m[93m/*[m                                                                                      
[34m[47m  [m[93m * Pseudo-random generator defined by the congruence S' = 69070 * S[m                     
[34m[47m  [m[93m * mod (2^32 - 5).  Marsaglia (CACM July 1993) says on page 107 that[m                    
[34m[47m  [m[93m * this is a ``good one''.  There you go.[m                                               
[34m[47m+ [m[38;5;248m[48;5;242m+--  3 lines: *-------------------------------------------------------------------------[m
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          
                                                                                          [12;3H[46m{[14;3H}[m[27;1H[34m[47m  [m[93m */[m
[34m[47m  [m[32mstatic[m [32mconst[m [32munsigned[m RNGMOD = (([38;5;130m1ULL[m << [38;5;130m32[m) - [38;5;130m5[m);
[34m[47m  [m[32mstatic[m [32mconst[m [32munsigned[m RNGMUL = [38;5;130m69070U[m;
[34m[47m  
  [m[32mstatic[m [32munsigned[m myrand(__cilkrts_worker *w)
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[32m[45munsigned[m[45m state = w->l->rand_seed;                                                   [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mstate = ([m[32m[45munsigned[m[45m)((RNGMUL * ([m[32m[45munsigned[m[45m [m[32m[45mlong[m[45m [m[32m[45mlong[m[45m)state) % RNGMOD);                  [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mw->l->rand_seed = state;                                                            [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;81m[45mreturn[m[45m state;                                                                       [m
[34m[47m  [m}
[34m[47m  
  [m[32mstatic[m [32mvoid[m mysrand(__cilkrts_worker *w, [32munsigned[m seed)
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[45mseed %= RNGMOD;                                                                     [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mseed += (seed == [m[38;5;130m[45m0[m[45m); [m[93m[45m/* 0 does not belong to the multiplicative[m[45m                     [m
[34m[47m  [m[93m[45m                          [m[1m[93m[41m  [m[93m[45mgroup.  Use 1 instead */[m[45m                                    [m
[34m[47m  [m[45m  [m[1m[41m  [m[45mw->l->rand_seed = seed;                                                             [m
[34m[47m  [m}
[34m[47m  
  [m[93m/* W grabs its own lock */[m
[34m[47m  [m[32mvoid[m __cilkrts_worker_lock(__cilkrts_worker *w)
[34m[47m  [m{
[34m[47m  [m[45m  [m[1m[41m  [m[45mvalidate_worker(w);                                                                 [m
[34m[47m  [m[45m  [m[1m[41m  [m[38;5;248m[104mCILK[m[45m_ASSERT(w->l->do_not_steal == [m[38;5;130m[45m0[m[45m);                                               [m
[34m[47m  [m[1;92H[34m[47m  [m[45m  [m[1m[41mdouble_link(child->left_sibling, child[m[45m->right_sibling);                              [m[2;92H[34m[47m  [m                                                                                       [3;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mif[m[1m[41m (!child[m[45m->right_sibling) {                                                         [m[4;92H[34m[47m  [m[45m    [m[93m[45m/* this is the rightmost child -- update parent link */[m[45m                            [m[5;92H[34m[47m  [m[45m    [m[38;5;248m[104mCILK[m[1m[41m_ASSERT(parent->rightmost_child == child[m[45m);                                     [m[6;92H[34m[47m  [m[45m    [m[1m[41mparent->rightmost_child = child[m[45m->left_sibling;                                     [m[7;92H[34m[47m  [m[45m  }                                                                                    [m[8;92H[34m[47m  [m[45m  [m[1m[41mchild->left_sibling = child[m[45m->right_sibling = [m[38;5;130m[45m0[m[45m; [m[93m[45m/* paranoia */[m[45m                       [m[9;92H[34m[47m  [m}                                                                                      [10;92H[34m[47m  [m                                                                                       [11;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mvoid[m[45m incjoin(full_frame *f)                                                     [m[12;92H[34m[47m  [m{                                                                                      [13;92H[34m[47m  [m[45m  [m[1m[41m++[m[45mf->join_counter;                                                                   [m[14;92H[34m[47m  [m}                                                                                      [15;92H[34m[47m  [m                                                                                       [16;92H[34m[47m  [m[32m[45mstatic[m[45m [m[32m[45mint[m[45m decjoin(full_frame *f)                                                      [m[17;92H[34m[47m  [m{                                                                                      [18;92H[34m[47m  [m[45m  [m[38;5;248m[104mCILK[m[1m[41m_ASSERT([m[45mf->join_counter > [m[38;5;130m[45m0[m[45m);                                                    [m[19;92H[34m[47m  [m[45m  [m[1m[38;5;81m[41mreturn[m[1m[41m (--[m[45mf->join_counter);                                                          [m[20;92H[34m[47m  [m}                                                                                      [21;92H[34m[47m  [m                                                                                       [22;92H[34m[47m  [m[93m/*[m                                                                                     [23;92H[34m[47m  [m[93m * Pseudo-random generator defined by the congruence S' = 69070 * S[m                    [24;92H[34m[47m  [m[93m * mod (2^32 - 5).  Marsaglia (CACM July 1993) says on page 107 that[m                   [25;92H[34m[47m  [m[93m * this is a ``good one''.  There you go.[m                                              [26;92H[34m[47m+ [m[38;5;248m[48;5;242m+--  3 lines: *------------------------------------------------------------------------[m[27;92H                                                                                         [28;92H                                                                                         [29;92H                                                                                         [30;92H                                                                                         [31;92H                                                                                         [32;92H                                                                                         [33;92H                                                                                         [34;92H                                                                                         [35;92H                                                                                         [36;92H                                                                                         [37;92H                                                                                         [38;92H                                                                                         [39;92H                                                                                         [40;92H                                                                                         [41;92H                                                                                         [42;92H                                                                                         [43;92H                                                                                         [44;92H                                                                                         [45;92H                                                                                         [46;92H                                                                                         [47;92H                                                                                         [48;92H                                                                                         [49;92H                                                                                         [50;92H                                                                                         [51;92H                                                                                         [52;92H                                                                                         [27;92H[34m[47m  [m[93m */[m[28;92H[34m[47m  [m[32mstatic[m [32mconst[m [32munsigned[m RNGMOD = (([38;5;130m1ULL[m << [38;5;130m32[m) - [38;5;130m5[m);[29;92H[34m[47m  [m[32mstatic[m [32mconst[m [32munsigned[m RNGMUL = [38;5;130m69070U[m;[30;92H[34m[47m  [31;92H  [m[32mstatic[m [32munsigned[m myrand(__cilkrts_worker *w)[32;92H[34m[47m  [m{[33;92H[34m[47m  [m[45m  [m[32m[45munsigned[m[45m state = w->l->rand_seed;                                                    [m[34;92H[34m[47m  [m[45m  state = ([m[32m[45munsigned[m[45m)((RNGMUL * ([m[32m[45munsigned[m[45m [m[32m[45mlong[m[45m [m[32m[45mlong[m[45m)state) % RNGMOD);                   [m[35;92H[34m[47m  [m[45m  w->l->rand_seed = state;                                                             [m[36;92H[34m[47m  [m[45m  [m[38;5;81m[45mreturn[m[45m state;                                                                        [m[37;92H[34m[47m  [m}[38;92H[34m[47m  [39;92H  [m[32mstatic[m [32mvoid[m mysrand(__cilkrts_worker *w, [32munsigned[m seed)[40;92H[34m[47m  [m{[41;92H[34m[47m  [m[45m  seed %= RNGMOD;                                                                      [m[42;92H[34m[47m  [m[45m  seed += (seed == [m[38;5;130m[45m0[m[45m); [m[93m[45m/* 0 does not belong to the multiplicative[m[45m                      [m[43;92H[34m[47m  [m[93m[45m                          group.  Use 1 instead */[m[45m                                     [m[44;92H[34m[47m  [m[45m  w->l->rand_seed = seed;                                                              [m[45;92H[34m[47m  [m}[46;92H[34m[47m  [47;92H  [m[93m/* W grabs its own lock */[m[48;92H[34m[47m  [m[32mvoid[m __cilkrts_worker_lock(__cilkrts_worker *w)[49;92H[34m[47m  [m{[50;92H[34m[47m  [m[45m  validate_worker(w);                                                                  [m[51;92H[34m[47m  [m[45m  [m[38;5;248m[104mCILK[m[45m_ASSERT(w->l->do_not_steal == [m[38;5;130m[45m0[m[45m);                                                [m[52;92H[34m[47m  [m[53;164H[7m27,1[11C8[m[53;74H[1m[7m89,1 [10C5%[12;3H[?12l[?25h[?25l[m[54;1HType  :quit<Enter>  to exit Vim[12;3H[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[?12l[?25h[?25l[55;1H[38;5;130m-- INSERT --[m[12;3H[46m [m[53;13H[1m[7m[+][61C3 [m[12;3H [14;3H}[12;5H[53;167H[7m2[12;5H[?12l[?25h[?25l[mc[53;77H[1m[7m4 [12;6H[?12l[?25h[55;1H[m[?1l>[?1049lVim: Caught deadly signal HUP
Vim: preserving files...
Vim: Finished.
[55;1H